/**
 * vAccordion - AngularJS multi-level accordion component
 * @version v0.0.4
 * @link http://lukaszwatroba.github.io/v-accordion
 * @author Łukasz Wątroba <l@lukaszwatroba.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(e){"use strict";function n(n){var o=this;n.isDisabled=!1,n.panes=[];var t=function(){for(var e=!1,o=0,t=n.panes.length;t>o;o++){var l=n.panes[o];if(l.isExpanded){e=!0;break}}return e},l=function(e){return n.panes[e]},a=function(e){return n.panes.indexOf(e)};o.disable=function(){n.isDisabled=!0},o.enable=function(){n.isDisabled=!1},o.addPane=function(e){if(!n.allowMultiple&&t()&&e.isExpanded)throw new Error("allow-multiple attribute is not set");n.panes.push(e),e.isExpanded&&n.internalControl.onExpand(a(e))},o.toggle=function(e){!n.isDisabled&&e&&(n.allowMultiple||o.collapseAll(e),e.isExpanded=!e.isExpanded,e.isExpanded?n.internalControl.onExpand(a(e)):n.internalControl.onCollapse(a(e)))},o.expand=function(e){!n.isDisabled&&e&&(n.allowMultiple||o.collapseAll(e),e.isExpanded||(e.isExpanded=!0,n.internalControl.onExpand(a(e))))},o.collapse=function(e){!n.isDisabled&&e&&e.isExpanded&&(e.isExpanded=!1,n.internalControl.onCollapse(a(e)))},o.expandAll=function(){if(!n.isDisabled){if(!n.allowMultiple)throw new Error("allow-multiple attribute is not set");e.forEach(n.panes,function(e){o.expand(e)})}},o.collapseAll=function(t){n.isDisabled||e.forEach(n.panes,function(e){e!==t&&o.collapse(e)})},n.internalControl={toggle:function(e){o.toggle(l(e))},expand:function(e){o.expand(l(e))},collapse:function(e){o.collapse(l(e))},expandAll:o.expandAll,collapseAll:o.collapseAll,onExpand:function(){},onCollapse:function(){}}}function o(e){var n=this;n.toggle=function(){e.isAnimating||e.accordionCtrl.toggle(e)}}function t(n){return{restrict:"EA",replace:!0,transclude:!0,template:"<div ng-transclude></div>",scope:{control:"=?",allowMultiple:"=?"},controllerAs:"accordionCtrl",controller:"vAccordionController",compile:function(o){return o.addClass(n.classes.accordion),function(n,o,t){if(e.isDefined(n.allowMultiple)||(n.allowMultiple=e.isDefined(t.allowMultiple)),!n.control)return n.control=n.internalControl,void 0;var l=["toggle","expand","collapse","expandAll","collapseAll"];e.forEach(l,function(e){if(n.control[e])throw new Error(e+" method can not be overwritten")});var a=e.extend({},n.internalControl,n.control);if(n.control=n.internalControl=a,!e.isFunction(n.control.onExpand))throw new Error("onExpand callback must be a function");if(!e.isFunction(n.control.onCollapse))throw new Error("onCollapse callback must be a function")}}}}function l(n,o,t){return{restrict:"EA",require:"^vAccordion",transclude:!0,replace:!0,template:"<div ng-transclude></div>",scope:{isExpanded:"=?expanded"},controllerAs:"paneCtrl",controller:"vPaneController",compile:function(l){return l.addClass(t.classes.pane),function(l,a,i,r){function c(){r.disable();var e=u.offsetHeight;p.style.maxHeight="0px",o.addClass(v,t.classes.expandedState).then(function(){r.enable(),p.style.maxHeight="none"}),setTimeout(function(){p.style.maxHeight=e+"px"},0),a.addClass(t.classes.expandedState),f.addClass(t.classes.expandedState)}function s(){r.disable();var e=u.offsetHeight;p.style.maxHeight=e+"px",o.removeClass(v,t.classes.expandedState).then(function(){r.enable()}),setTimeout(function(){p.style.maxHeight="0px"},0),a.removeClass(t.classes.expandedState),f.removeClass(t.classes.expandedState)}e.isDefined(l.isExpanded)||(l.isExpanded=e.isDefined(i.expanded));var d=a[0].querySelector("."+t.classes.paneHeader),p=a[0].querySelector("."+t.classes.paneContent);if(!d)throw new Error("v-pane-header not found");if(!p)throw new Error("v-pane-content not found");var u=p.querySelector("div"),f=e.element(d),v=e.element(p);r.addPane(l),l.accordionCtrl=r,p.style.maxHeight="0px",n(function(){l.isExpanded&&c()},100),l.$watch("isExpanded",function(e,n){return e===n?!0:(e?c():s(),void 0)})}}}}function a(e){return{restrict:"EA",require:"^vPane",transclude:!0,replace:!0,template:'<div ng-click="paneCtrl.toggle()"><div ng-transclude></div></div>',scope:{},compile:function(n){return n.addClass(e.classes.paneHeader),function(e,n,o,t){e.paneCtrl=t}}}}function i(e){return{restrict:"EA",require:"^vPane",transclude:!0,replace:!0,template:"<div><div ng-transclude></div></div>",scope:{},compile:function(n){return n.addClass(e.classes.paneContent),function(e,n,o,t){e.paneCtrl=t}}}}e.module("vAccordion",["ngAnimate","vAccordion.config","vAccordion.controllers","vAccordion.directives"]),e.module("vAccordion.config",[]).constant("accordionConfig",{classes:{accordion:"Accordion Accordion--dafault",pane:"Accordion-pane",paneHeader:"Accordion-paneHeader",paneContent:"Accordion-paneContent",expandedState:"is-expanded"}}),e.module("vAccordion.controllers",[]).controller("vAccordionController",n).controller("vPaneController",o),n.$inject=["$scope"],o.$inject=["$scope"],e.module("vAccordion.directives",[]).directive("vAccordion",t).directive("vPane",l).directive("vPaneHeader",a).directive("vPaneContent",i),t.$inject=["accordionConfig"],l.$inject=["$timeout","$animate","accordionConfig"],a.$inject=["accordionConfig"],i.$inject=["accordionConfig"]}(angular);