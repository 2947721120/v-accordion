/**
 * vAccordion - AngularJS multi-level accordion component
 * @version v1.0.0
 * @link http://lukaszwatroba.github.io/v-accordion
 * @author Łukasz Wątroba <l@lukaszwatroba.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(n){"use strict";function e(){return{restrict:"E",transclude:!0,controller:t,scope:{control:"=?",allowMultiple:"=?multiple",expandCb:"&?onexpand",collapseCb:"&?oncollapse"},link:function(e,t,i,o,a){function l(){n.forEach(c,function(n){if(e.control[n])throw new Error("The `"+n+"` method can not be overwritten")})}a(e.$parent,function(n){t.append(n)});var c=["toggle","expand","collapse","expandAll","collapseAll"];if(n.isDefined(e.allowMultiple)||(e.allowMultiple=n.isDefined(i.multiple)),n.isDefined(e.control)){l();var d=n.extend({},e.internalControl,e.control);e.control=e.internalControl=d}else e.control=e.internalControl}}}function t(e){function t(){for(var n=!1,t=0,i=e.panes.length;i>t;t++){var o=e.panes[t];if(o.isExpanded){n=!0;break}}return n}function i(n){return e.panes[n]}function o(n){return e.panes.indexOf(n)}var a=this,l=!1;e.panes=[],a.disable=function(){l=!0},a.enable=function(){l=!1},a.addPane=function(n){if(!e.allowMultiple&&t()&&n.isExpanded)throw new Error("The `multiple` attribute can't be found");e.panes.push(n),n.isExpanded&&e.expandCb({index:o(n)})},a.toggle=function(n){!l&&n&&(e.allowMultiple||a.collapseAll(n),n.isExpanded=!n.isExpanded,n.isExpanded?e.expandCb({index:o(n)}):e.collapseCb({index:o(n)}))},a.expand=function(n){!l&&n&&(e.allowMultiple||a.collapseAll(n),n.isExpanded||(n.isExpanded=!0,e.expandCb({index:o(n)})))},a.collapse=function(n){!l&&n&&n.isExpanded&&(n.isExpanded=!1,e.collapseCb({index:o(n)}))},a.expandAll=function(){if(!l){if(!e.allowMultiple)throw new Error("The `multiple` attribute can't be found");n.forEach(e.panes,function(n){a.expand(n)})}},a.collapseAll=function(t){l||n.forEach(e.panes,function(n){n!==t&&a.collapse(n)})},e.internalControl={toggle:function(n){a.toggle(i(n))},expand:function(n){a.expand(i(n))},collapse:function(n){a.collapse(i(n))},expandAll:a.expandAll,collapseAll:a.collapseAll}}function i(){return{restrict:"E",require:"^vPane",transclude:!0,template:"<v-pane-content-inner ng-transclude></v-pane-content-inner>",scope:{},link:function(){}}}function o(){return{restrict:"E",require:"^vPane",transclude:!0,template:"<v-pane-header-inner ng-transclude></v-pane-header-inner>",scope:{},link:function(n,e,t,i){e.on("click",function(){n.$apply(function(){i.toggle()})})}}}function a(e,t,i){return{restrict:"E",require:"^vAccordion",transclude:!0,controller:l,scope:{isExpanded:"=?expanded"},link:function(o,a,l,c,d){function r(){c.disable(),f[0].style.maxHeight="0px",e(function(){t.addClass(a,s.expanded).then(function(){c.enable(),f[0].style.maxHeight="none"}),setTimeout(function(){f[0].style.maxHeight=x[0].offsetHeight+"px"},0)},0)}function p(){c.disable(),f[0].style.maxHeight=x[0].offsetHeight+"px",e(function(){t.removeClass(a,s.expanded).then(function(){c.enable()}),setTimeout(function(){f[0].style.maxHeight="0px"},0)},0)}d(o.$parent,function(n){a.append(n)}),n.isDefined(o.isExpanded)||(o.isExpanded=n.isDefined(l.expanded));var s=i.states,u=a.find("v-pane-header"),f=a.find("v-pane-content"),x=a.find("v-pane-content-inner");if(!u[0])throw new Error("The `v-pane-header` directive can't be found");if(!f[0])throw new Error("The `v-pane-content` directive can't be found");c.addPane(o),o.accordionCtrl=c,f[0].style.maxHeight="0px",o.isExpanded&&(a.addClass(s.expanded),f[0].style.maxHeight="none"),o.$watch("isExpanded",function(n,e){return n===e?!0:(n?r():p(),void 0)})}}}function l(n){var e=this;e.toggle=function(){n.isAnimating||n.accordionCtrl.toggle(n)}}n.module("vAccordion.config",[]).constant("accordionConfig",{states:{expanded:"is-expanded"}}),n.module("vAccordion.directives",[]),n.module("vAccordion",["vAccordion.config","vAccordion.directives"]),n.module("vAccordion.directives").directive("vAccordion",e),t.$inject=["$scope"],n.module("vAccordion.directives").directive("vPaneContent",i),n.module("vAccordion.directives").directive("vPaneHeader",o),n.module("vAccordion.directives").directive("vPane",a),a.$inject=["$timeout","$animate","accordionConfig"],l.$inject=["$scope"]}(angular);